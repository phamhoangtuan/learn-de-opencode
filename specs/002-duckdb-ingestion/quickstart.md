# Quickstart: DuckDB Ingestion Pipeline

**Feature**: 002-duckdb-ingestion  
**Date**: 2026-02-18

## Prerequisites

- Python 3.11+
- [uv](https://docs.astral.sh/uv/) package manager
- Raw Parquet files in `data/raw/` (generated by Feature 001)

## Generate Sample Data (if needed)

```bash
uv run src/generate_transactions.py --count 10000 --seed 42
```

This creates `data/raw/transactions_YYYYMMDD_HHMMSS.parquet`.

## Run the Ingestion Pipeline

```bash
uv run src/ingest_transactions.py
```

### With Custom Options

```bash
# Specify source directory and database path
uv run src/ingest_transactions.py --source-dir data/raw/ --db-path data/warehouse/transactions.duckdb

# Verbose logging
uv run src/ingest_transactions.py --log-level DEBUG
```

## Verify the Results

After ingestion, query the warehouse using DuckDB CLI or Python:

```python
import duckdb

conn = duckdb.connect("data/warehouse/transactions.duckdb")

# Count loaded records
conn.sql("SELECT COUNT(*) FROM transactions").show()

# Check lineage
conn.sql("SELECT source_file, run_id, COUNT(*) FROM transactions GROUP BY 1, 2").show()

# Query by date range
conn.sql("SELECT * FROM transactions WHERE transaction_date = '2026-01-15' LIMIT 5").show()

# Check quarantine
conn.sql("SELECT * FROM quarantine").show()

# Review ingestion runs
conn.sql("SELECT * FROM ingestion_runs ORDER BY started_at DESC").show()

conn.close()
```

## Run Tests

```bash
uv run pytest tests/ -v
```

## Project Structure

```text
src/
├── ingest_transactions.py     # CLI entrypoint
├── ingestion/
│   ├── __init__.py
│   ├── pipeline.py            # Orchestration
│   ├── validator.py           # Schema + value validation
│   ├── loader.py              # DuckDB write operations
│   ├── dedup.py               # Deduplication logic
│   └── models.py              # Ingestion domain models
├── models/                    # (Feature 001) Transaction schema
└── lib/                       # (Feature 001) Shared utilities

tests/
├── unit/
│   ├── test_validator.py
│   ├── test_loader.py
│   └── test_dedup.py
├── integration/
│   └── test_pipeline.py
└── quality/
    └── test_data_quality.py
```
